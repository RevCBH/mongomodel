#!/usr/bin/env ruby

puts "Loading MongoModel sandbox..."

begin
  # Try to require the preresolved locked set of gems.
  require File.expand_path('../../.bundle/environment', __FILE__)
rescue LoadError
  # Fall back on doing an unlocked resolve at runtime.
  require "rubygems"
  require "bundler"
  Bundler.setup
end

$LOAD_PATH.unshift(File.dirname(__FILE__) + '/../lib')

require 'irb'
require 'irb/completion'

require 'mongomodel'

IRB.setup(nil)

IRB.conf[:USE_READLINE] = true
IRB.conf[:PROMPT_MODE] = :SIMPLE

irb = IRB::Irb.new

IRB.conf[:MAIN_CONTEXT] = irb.context

examples = <<-EXAMPLES
  
  class Article < MongoModel::Document
    property :title, String
    property :published, Boolean, :default => false
    
    timestamps!
    
    default_scope :order => :title.asc
    
    named_scope :published, :conditions => { :published => true }
    named_scope :latest, lambda { |num| { :limit => num, :order => 'created_at DESC' } }
  end
  
EXAMPLES

puts examples
irb.context.evaluate(examples, 0)

trap("SIGINT") do
  irb.signal_handle
end
catch(:IRB_EXIT) do
  irb.eval_input
end
